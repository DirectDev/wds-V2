{% extends 'FrontFrontBundle::layout.html.twig' %}

{% block title %}
    {{ entity.getTitle|capitalize }}
{% endblock %}

{% block content %}

    {% set event =  edit_form.vars.value  %}

    <div class="page-banner">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h2>{{ entity.getTitle }}</h2>
                </div>
                <div class="col-md-6">
                    <div class='pull-right'>
                        <a href="{{ path('front_event_show', {id : event.id, uri : event.getURI }) }}" class="btn btn-warning btn-sm pull-right">
                            <i class="glyphicon glyphicon-arrow-left"></i>
                            <span> {% trans %}front.back{% endtrans %}</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="content">
        <div class="container">

            {% form_theme edit_form with ['FrontFrontBundle:Form:bootstrap_form_override.html.twig'] %}

            {{ form_errors(edit_form) }}
            {# {{ form_errors(edit_form.addresses) }}
             {{ form_errors(edit_form.eventDates) }}#}

            <div class="recent-projects">  

                <h4 class="classic-title"><span>{% trans %}event.event_title{% endtrans %}</span></h4>


                {{ form_start(edit_form) }}
                {{ form_errors(edit_form) }}

                {{ form_row(edit_form.musicTypes) }}
                {{ form_row(edit_form.eventType) }}
                {{ form_row(edit_form.translations) }}


                {#<h4 class="classic-title"><span>{% trans %}event.addresses_title{% endtrans %}</span></h4>
                    <ul class="addresses" data-prototype="{{ form_widget(edit_form.addresses.vars.prototype)|e }}">
                        {% for address in edit_form.addresses %}
                            <li>
                                {{ form_row(address.name) }}
                                {{ form_row(address.street) }}
                                {{ form_row(address.streetComplement) }}
                                {{ form_row(address.postcode) }}
                                {{ form_row(address.city) }}                                    
                                {{ form_row(address.country) }}         
                            </li>
                        {% endfor %}
                    </ul>#}


                {#<h4 class="classic-title"><span>{% trans %}event.eventdates_title{% endtrans %}</span></h4>
                    <ul class="eventdate" data-prototype="{{ form_widget(edit_form.eventDates.vars.prototype)|e }}">
                        {% for eventDate in edit_form.eventDates %}
                            <li>
                                {{ form_row(eventDate.startdate) }}
                                {{ form_row(eventDate.starttime) }}
                                {{ form_row(eventDate.stopdate) }}                                  
                                {{ form_row(eventDate.stoptime) }}                                  
                            </li>
                        {% endfor %}
                    </ul>#}

                <div class='row'>
                    <div class='col-md-1 pull-right'>
                        {{ form_row(edit_form.submit) }}
                    </div>
                </div>


                {{ form_end(edit_form) }}

                <h4 class="classic-title" id='images'><span>{% trans %}event.images_title{% endtrans %}</span></h4>
                <div class='panel-footer'>
                    {% set action_path = path('front_event_edit' , { id: entity.id, editId: editId }) %}
                    {% include 'FileFileBundle::uploadFileForm.html.twig' with {
                        action_path: action_path,
                        cancel_path: 'front_event',
                        delete_path: 'front_event_delete',
                        id: entity.id, 
                        editId: editId, 
                        existingFiles: existingFiles,
                        entity: entity,
                } %}
                </div>

            </div>

        </div>
    </div>


    {#<script>
        
        var $collectionHolderAddress;

        // setup an "add a address" link
        var $addLinkAddress = $("<a href='#' class='add_address_link'>{% trans %}front.link_add_address{% endtrans %}</a>");
        var $newLinkLiAddress = $('<li></li>').append($addLinkAddress);
        var $removeFormAAddress = $("<a href='#'>{% trans %}front.link_delete_address{% endtrans %}</a>");

        jQuery(document).ready(function() {
            // Get the ul that holds the collection of addresss
            $collectionHolderAddress = $('ul.addresses');

            $collectionHolderAddress.find('li').each(function() {
                addFormDeleteLink($(this));
            });

            // add the "add a address" anchor and li to the addresss ul
            $collectionHolderAddress.append($newLinkLiAddress);

            // count the current form inputs we have (e.g. 2), use that as the new
            // index when inserting a new item (e.g. 2)
            $collectionHolderAddress.data('index', $collectionHolderAddress.find(':input').length);

            $addLinkAddress.on('click', function(e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // add a new address form (see next code block)
                addForm($collectionHolderAddress, $newLinkLiAddress);
                
                //efface le lien pour qu'il n'y ai qu'une addresse
                $addLinkAddress.hide();
                
            });
            
            {% if edit_form.addresses|length %}
                $addLinkAddress.hide();
            {% endif %}
        });

        function addForm($collectionHolderAddress, $newLinkLiAddress) {
            // Get the data-prototype explained earlier
            var prototype = $collectionHolderAddress.data('prototype');

            // get the new index
            var index = $collectionHolderAddress.data('index');

            // Replace '__name__' in the prototype's HTML to
            // instead be a number based on how many items we have
            //var newForm = prototype.replace(/__name__/g, index);
            var newForm = prototype.replace(/__name__/g, index);

            // increase the index with one for the next item
            $collectionHolderAddress.data('index', index + 1);

            // Display the form in the page in an li, before the "Add a address" link li
            var $newFormLi = $('<li></li>').append(newForm);
            $newLinkLiAddress.before($newFormLi);

            addFormDeleteLink($newFormLi);
        }

        function addFormDeleteLink($FormLi) {
            
            $FormLi.append($removeFormAAddress);

            $removeFormAAddress.on('click', function(e) {
                // prevent the link from creating a "#" on the URL
                e.preventDefault();

                // remove the li for the  form
                $FormLi.remove();
                
                $addLinkAddress.show();
            });

        }
        
        
    </script> 
    
    <script>
        
        var collectionHolder = $('ul.eventdate');

        var $addTagLink = $('<a href="#" class="add_tag_link">{% trans %}front.link_add_eventdate{% endtrans %}</a>');
        var $newLinkLi = $('<li></li>').append($addTagLink);

        jQuery(document).ready(function() {

            collectionHolder.find('li').each(function() {
                addTagFormDeleteLink($(this));
            });

            collectionHolder.append($newLinkLi);

            $addTagLink.on('click', function(e) {
                e.preventDefault();

                addTagForm(collectionHolder, $newLinkLi);
            });
        });

        function addTagForm(collectionHolder, $newLinkLi) {
            var prototype = collectionHolder.attr('data-prototype');

            var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);

            var $newFormLi = $('<li></li>').append(newForm);
            addTagFormDeleteLink($newFormLi);
            $newLinkLi.before($newFormLi);
        }

        function addTagFormDeleteLink($tagFormLi) {
            var $removeFormA = $('<a href="#">{% trans %}front.link_delete_eventdate{% endtrans %}</a>');
            $tagFormLi.append('</br>');
            $tagFormLi.append($removeFormA);

            $removeFormA.on('click', function(e) {
                e.preventDefault();

                $tagFormLi.remove();
            });
        }
        
    </script>#}

    <script>
        $(document).on('click focus', 'form input.datepicker', function () {

            $("form input.datepicker").datepicker({
                format: "yyyy-mm-dd", // bug avec les heures
                autoclose: true,
                language: "{{ app.request.locale }}"
            });
        });
    </script>

{% endblock %}    

{% block bottomJavascripts %}
    {{ parent() }}
    <script src="{{ asset('js/underscore-min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/punkavefileuploader/js/jquery.fileupload.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/punkavefileuploader/js/jquery.iframe-transport.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/punkavefileuploader/js/FileUploader.js') }}" type="text/javascript"></script> 
{% endblock %}          
